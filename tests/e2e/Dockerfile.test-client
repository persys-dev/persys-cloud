FROM golang:1.24-alpine AS builder

WORKDIR /src
COPY persys-scheduler ./persys-scheduler
RUN cd /src/persys-scheduler && go build -o /out/smoke-client ./cmd/smoke-client

FROM alpine:3.21
RUN apk add --no-cache ca-certificates curl jq bash
WORKDIR /app
COPY --from=builder /out/smoke-client ./smoke-client
COPY tests/e2e/test-suite.sh ./test-suite.sh
RUN chmod +x ./smoke-client ./test-suite.sh

CMD ["/bin/sh", "-c", "./test-suite.sh"]
